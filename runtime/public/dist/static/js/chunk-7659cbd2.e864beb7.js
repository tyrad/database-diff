(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7659cbd2"],{"00fe":function(t,e,n){},"911b":function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{margin:"0 auto",width:"300px"}},[n("div",{staticStyle:{color:"red","margin-bottom":"10px"}},[t._v(" 鉴权出错，请登录后再尝试 ")]),n("div",{staticStyle:{display:"flex","align-items":"center","justify-items":"center"}},[n("img",{staticStyle:{padding:"5px"},attrs:{src:t.imageUrl,alt:""}}),n("el-button",{staticStyle:{padding:"5px"},attrs:{size:"mini"},on:{click:t.refReloadCodeImage}},[t._v("点击刷新验证码")])],1),n("el-input",{staticStyle:{margin:"5px",width:"200px"},attrs:{placeholder:"请输入验证码",clearable:""},model:{value:t.code,callback:function(e){t.code=e},expression:"code"}})],1)},i=[],a=(n("d3b7"),n("b5f9")),s={name:"Login",data:function(){return{loading:!1,imageUrl:"",code:""}},methods:{getImageUrl:function(){return this.imageUrl?window.location.origin+this.imageUrl:""},login:function(){var t=this;this.loading=!0,Object(a["h"])(this.code).then((function(){t.$emit("loginSuccess")})).finally((function(){t.loading=!1}))},refReloadCodeImage:function(){var t=this;this.loading=!0,Object(a["f"])().then((function(e){console.log(e),t.imageUrl=e.data.path})).finally((function(){t.loading=!1}))}}},r=s,l=n("2877"),c=Object(l["a"])(r,o,i,!1,null,"36c194cc",null);e["a"]=c.exports},"91b9":function(t,e,n){"use strict";n("99e9")},"99e9":function(t,e,n){},b5f9:function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"f",(function(){return l})),n.d(e,"h",(function(){return c})),n.d(e,"g",(function(){return u})),n.d(e,"b",(function(){return d})),n.d(e,"c",(function(){return m})),n.d(e,"i",(function(){return p})),n.d(e,"e",(function(){return f})),n.d(e,"d",(function(){return g})),n.d(e,"j",(function(){return h}));var o=n("5530"),i=n("b775"),a=n("4328"),s=n.n(a);function r(t){return Object(i["a"])({url:"/checkAccountValid",method:"post",data:s.a.stringify(Object(o["a"])({},t))})}function l(){return Object(i["a"])({url:"/getCodeImage",method:"get"})}function c(t){return Object(i["a"])({url:"/loginWithCode",method:"get",params:{code:t}})}function u(t){return Object(i["a"])({url:"/getHospitalCode",method:"get",params:{name:t}})}function d(t){return Object(i["a"])({url:"/createYxAccountOrUpdate",method:"post",data:s.a.stringify(Object(o["a"])({},t))})}function m(t,e){return Object(i["a"])({url:"/deleteDoctor",method:"get",params:{doctorId:t,phoneNo:e}})}function p(t){return Object(i["a"])({url:"/resetPassword",method:"get",params:{doctorId:t}})}function f(){return Object(i["a"])({url:"/getAreaCode",method:"get"})}function g(t){return Object(i["a"])({url:"/fixedRoleToDoctor",method:"get",params:{phone:t}})}function h(t){return Object(i["a"])({url:"/uploadFile",method:"post",data:t,headers:{"Content-Type":"multipart/form-data;"}})}},bfb8:function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("UploadForm")],1)},i=[],a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-form",{ref:"elForm",attrs:{model:t.formData,rules:t.rules,size:"small","label-width":"130px"}},[n("el-form-item",{attrs:{label:"原始账号数据",prop:"originFile",required:""}},[n("upload-pro",{attrs:{tips:'csv格式为:"所在卫生院名称,姓名,手机号,性别,公卫账号"。 例如:"双龙山卫生院,鲁迅,15000000000,男,admin"',"union-flag":t.unionFlag,type:"origin_data"},model:{value:t.formData.originFile,callback:function(e){t.$set(t.formData,"originFile",e)},expression:"formData.originFile"}})],1),n("el-form-item",{attrs:{label:"卫生院编码关系",prop:"hospitalCodeRelation"}},[n("upload-pro",{attrs:{tips:"如果不添加，只使用默认的配置文件'runtime/csv/nameToHostpitalCode.csv'","union-flag":t.unionFlag,type:"hospitalCodeRelation"},model:{value:t.formData.hospitalCodeRelation,callback:function(e){t.$set(t.formData,"hospitalCodeRelation",e)},expression:"formData.hospitalCodeRelation"}})],1),n("el-form-item",{attrs:{size:"large"}},[n("el-button",{on:{click:t.resetForm}},[t._v("重置")])],1),n("el-button",{staticStyle:{"margin-bottom":"10px"},attrs:{type:"primary"},on:{click:function(e){return t.submitForm("1")}}},[t._v("step1: 数据过滤")]),t.runTimeData.step1Success?n("i",{staticClass:"el-icon-download",staticStyle:{padding:"10px","margin-left":"10px",cursor:"pointer"},on:{click:function(e){return t.download(t.runTimeData.step1ResultCsv)}}}):t._e(),t._v(" 【目前不支持批量验证公卫账号是否有效,需要后期新增接口】 "),n("br"),n("el-button",{staticStyle:{"margin-bottom":"10px"},attrs:{disabled:!t.runTimeData.step1Success,type:"primary"},on:{click:function(e){return t.submitForm("2")}}},[t._v("step2: 医信数据导入 ")]),t.runTimeData.step2Success?n("i",{staticClass:"el-icon-download",staticStyle:{padding:"10px","margin-left":"10px",cursor:"pointer"},on:{click:function(e){return t.download(t.runTimeData.step2ResultCsv)}}}):t._e(),n("br"),n("el-button",{staticStyle:{"margin-bottom":"10px"},attrs:{disabled:!t.runTimeData.step2Success,type:"primary"},on:{click:function(e){return t.submitForm("3")}}},[t._v("step3: 检查并完善用户机构、工号、角色 ")]),t.runTimeData.step3Success?n("i",{staticClass:"el-icon-download",staticStyle:{padding:"10px","margin-left":"10px",cursor:"pointer"},on:{click:function(e){return t.download(t.runTimeData.step3ResultCsv)}}}):t._e()],1),n("div",{staticStyle:{"background-color":"black",color:"white",padding:"8px","max-height":"500px",overflow:"auto"},attrs:{id:"xxxContent"}},[n("div",{domProps:{innerHTML:t._s(t.socketContent)}})]),t.socketContent?n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){t.socketContent=""}}},[t._v("清除Log ")]):t._e(),n("LoginDialog",{attrs:{visible:t.showLoginDialog,title:"登录"},on:{"update:visible":function(e){t.showLoginDialog=e}}})],1)},s=[],r=(n("5319"),n("ac1f"),n("caad"),n("2532"),n("1276"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"zy-upload-edu",staticStyle:{display:"inline-block"}},[n("el-upload",{ref:"upload",staticClass:"upload",staticStyle:{display:"inline-block"},attrs:{action:"/",accept:".csv","http-request":t.uploadFile,limit:t.limit,"on-exceed":t.handleExceed,"show-file-list":!1,"list-type":"text"}},[n("el-button",{attrs:{type:"primary",size:"mini"}},[t._v("选择文件")]),t.tips?n("el-tooltip",{attrs:{placement:"bottom"}},[n("div",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(t.tips))]),n("i",{staticClass:"el-icon-info",staticStyle:{"margin-left":"10px"}})]):t._e(),n("span",[t._v(" "+t._s(t.value)+" ")])],1),t.value?n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.clearFile}},[t._v("清除")]):t._e()],1)}),l=[],c=(n("a9e3"),n("b5f9")),u={name:"UploadPro",props:{unionFlag:{type:String,default:""},value:{type:String,default:""},limit:{type:Number,default:1},type:{type:String,default:""},tips:{type:String,default:""}},data:function(){return{dialogImageUrl:"",disabled:!1}},methods:{emitFilePath:function(t){this.$emit("input",t)},handleRemove:function(t){this.emitFilePath("")},handleExceed:function(){this.$message.warning("最多上传 ".concat(this.limit," 个文件。"))},uploadFile:function(t){var e=this;console.log(t);var n=new FormData;n.append("file",t.file),n.append("unionFlag",this.unionFlag),n.append("type",this.type),Object(c["j"])(n).then((function(n){e.$message.success("上传成功"),t.onSuccess(n),e.emitFilePath(n.data)})).catch((function(n){e.$message.error("上传失败:"+n),t.onError(n)}))},clearFile:function(){this.emitFilePath(""),this.$refs.upload.clearFiles()}}},d=u,m=(n("eec3"),n("2877")),p=Object(m["a"])(d,r,l,!1,null,null,null),f=p.exports,g=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-dialog",t._g(t._b({on:{open:t.onOpen,close:t.onClose}},"el-dialog",t.$attrs,!1),t.$listeners),[n("Login",{ref:"loginFormRef",on:{loginSuccess:t.close}}),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:t.close}},[t._v("取消")]),n("el-button",{attrs:{type:"primary"},on:{click:t.handelConfirm}},[t._v("确定")])],1)],1)],1)},h=[],b=n("911b"),v={name:"LoginDialog",components:{Login:b["a"]},inheritAttrs:!1,props:{},data:function(){return{}},computed:{rules:function(){return{}}},watch:{},created:function(){},mounted:function(){},methods:{onOpen:function(){},onClose:function(){},close:function(){this.$emit("update:visible",!1)},handelConfirm:function(){this.$refs.loginFormRef.login()}}},w=v,y=Object(m["a"])(w,g,h,!1,null,null,null),C=y.exports,k={name:"UploadForm",components:{LoginDialog:C,UploadPro:f},props:[],data:function(){return{showLoginDialog:!1,unionFlag:(new Date).getTime()+"",formData:{originFile:"",hospitalCodeRelation:""},rules:{},runTimeData:{step1Success:!1,step1ResultCsv:"",step2Success:!1,step2ResultCsv:"",step3Success:!1,step3ResultCsv:""},socketContent:"",lockReconnect:!1,timeout:58e3,timeoutObj:null,serverTimeoutObj:null,timeoutnum:null}},created:function(){},mounted:function(){this.initWebSocket()},methods:{filterResult:function(t){var e="/resultCsvDownload/"+t.replace("runtime/dataImport/import/","");return window.location.origin+e},download:function(t){window.open(this.filterResult(t))},submitForm:function(t){var e=this;this.$refs["elForm"].validate((function(n){n&&e.submitDoAction(t)}))},resetForm:function(){this.$refs["elForm"].resetFields()},submitDoAction:function(t){if(1===this.websock.readyState){"1"===t&&(this.socketContent="");var e={step:t,originFile:this.formData.originFile,hospitalCodeRelation:this.formData.hospitalCodeRelation,step1ResultCsv:this.runTimeData.step1ResultCsv,step2ResultCsv:this.runTimeData.step2ResultCsv};this.websock.send(JSON.stringify(e))}else this.$message({message:"服务端未连接，请刷新重试",type:"error"})},initWebSocket:function(){var t="ws://".concat(window.location.host,"/yxx/runningImport");this.websock=new WebSocket(t),this.websock.onmessage=this.websocketOnMessage,this.websock.onopen=this.websocketOnOpen,this.websock.onerror=this.websocketOnerror,this.websock.onclose=this.websocketClose},websocketOnMessage:function(t){if(console.log(t.data),t.data.includes("STEP_ONE_SUCCESS:"))return this.runTimeData.step1Success=!0,void(this.runTimeData.step1ResultCsv=t.data.split(":")[1]);if(t.data.includes("STEP_TWO_SUCCESS:"))return this.runTimeData.step2Success=!0,void(this.runTimeData.step2ResultCsv=t.data.split(":")[1]);if(t.data.includes("STEP_THREE_SUCCESS:"))return this.runTimeData.step3Success=!0,void(this.runTimeData.step3ResultCsv=t.data.split(":")[1]);this.socketContent+=t.data+"<br>";var e=document.getElementById("xxxContent");e.scrollTop=e.scrollHeight+50,this.reset(),t.data.includes("重新登录")&&(this.showLoginDialog=!0)},websocketOnOpen:function(){this.start()},websocketOnerror:function(){console.log("出现错误"),this.reconnect()},websocketClose:function(t){console.log("断开连接",t),this.reconnect()},start:function(){console.log("开启心跳");var t=this;t.timeoutObj&&clearTimeout(t.timeoutObj),t.serverTimeoutObj&&clearTimeout(t.serverTimeoutObj),t.timeoutObj=setTimeout((function(){1===t.websock.readyState?t.websock.send("heart beat"):t.reconnect(),t.serverTimeoutObj=setTimeout((function(){t.websock.close()}),t.timeout)}),t.timeout)},reconnect:function(){var t=this;t.lockReconnect||(t.lockReconnect=!0,t.timeoutnum&&clearTimeout(t.timeoutnum),t.timeoutnum=setTimeout((function(){t.initWebSocket(),t.lockReconnect=!1}),5e3))},reset:function(){var t=this;clearTimeout(t.timeoutObj),clearTimeout(t.serverTimeoutObj),t.start()}}},S=k,x=(n("91b9"),Object(m["a"])(S,a,s,!1,null,null,null)),O=x.exports,_={name:"Index",components:{UploadForm:O}},D=_,T=Object(m["a"])(D,o,i,!1,null,"73f16f1e",null);e["default"]=T.exports},eec3:function(t,e,n){"use strict";n("00fe")}}]);